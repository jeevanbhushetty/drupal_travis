language: php

php:
  - 5.6

before_install:

#  # Enable $_ENV variables in PHP.
#  - echo 'variables_order = "EGPCS"' >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/travis.ini
#  # Ensure that always_populate_raw_post_data PHP setting: Not set to -1 does not happen.
#  - echo "always_populate_raw_post_data = -1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
#  # Set PHP memory limit to something more realistic.
#  - echo "memory_limit=512M" >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/travis.ini
  - sudo apt-get update > /dev/null
  - composer self-update
  - sed -i '1i export PATH="$HOME/.config/composer/vendor/bin:$PATH"' $HOME/.bashrc
  - source $HOME/.bashrc
  - rm -f ~/.drush/cache/download/*---updates.drupal.org-release-history-*
  - composer global require drush/drush:^8.1
  - cd $TRAVIS_BUILD_DIR/tests/behat && composer install
  - phpenv rehash

install:

  - drush status
  # Create MySQL Database
  - mysql -e 'create database drupal;'
  - cd $TRAVIS_BUILD_DIR
  - /usr/bin/env PHP_OPTIONS="-d sendmail_path=`which true`" drush --verbose --yes site-install --db-url="mysql://root:@127.0.0.1/drupal"
  - drush cc all --yes

  # Install and configure Apache and PHP-FPM.
  - sudo apt-get install apache2 libapache2-mod-fastcgi
  - sudo cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
  - sudo a2enmod rewrite actions fastcgi alias
  - echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
  - sudo service apache2 restart

script:

#  - cd $TRAVIS_BUILD_DIR/tests/behat
#  - composer install
  - bin/behat --profile=ci